# Technology Stack: PharmaGuard AI

## 1. STACK OVERVIEW
- **Architecture:** Monolithic REST API + Static Single Page Application (SPA).
- **Pattern:** Stateless Backend. The system processes VCF files in memory, returns the analysis, and discards all genomic data. No database persistence is used to ensure maximum patient privacy.
- **Justification:** Optimized for 24-hour hackathon constraints, prioritizing rapid development, zero-data-retention security, and high-performance parsing.

---

## 2. FRONTEND STACK

| Library | Version | Documentation | Reason for Choice |
| :--- | :--- | :--- | :--- |
| **Vite** | ^6.0.0 | [vitejs.dev](https://vitejs.dev/) | Ultra-fast HMR and build times for rapid iteration. |
| **React** | ^18.3.0 | [react.dev](https://react.dev/) | Robust ecosystem and declarative UI components. |
| **TypeScript** | ^5.5.0 | [typescriptlang.org](https://www.typescriptlang.org/) | Type safety for complex genomic data structures. |
| **Tailwind CSS** | ^3.4.0 | [tailwindcss.com](https://tailwindcss.com/) | Utility-first styling for "Clinical Precision" theme. |
| **Lucide React** | ^0.475.0 | [lucide.dev](https://lucide.dev/) | Consistent, accessible, and lightweight iconography. |
| **Framer Motion** | ^11.18.0 | [framer.com/motion](https://www.framer.com/motion/) | Orchestrating clinical-grade micro-interactions. |
| **Axios** | ^1.7.0 | [axios-http.com](https://axios-http.com/) | Reliable HTTP client with interceptor support. |

- **TSConfig:** `strict` mode enabled to catch nullability issues in genomic parsing.
- **Tailwind:** Custom configuration for "Clinical Dark" theme using CSS variables.

---

## 3. BACKEND STACK

| Library | Version | Documentation | Reason for Choice |
| :--- | :--- | :--- | :--- |
| **Node.js** | 20 LTS | [nodejs.org](https://nodejs.org/) | Stable runtime with excellent asynchronous I/O. |
| **Express** | ^4.19.0 | [expressjs.com](https://expressjs.com/) | Standard minimalist web framework for REST APIs. |
| **Multer** | ^1.4.5 | [github.com/expressjs/multer](https://github.com/expressjs/multer) | Handling multi-part/form-data for VCF file uploads. |
| **@google/genai** | ^1.42.0 | [ai.google.dev](https://ai.google.dev/) | Direct integration with Gemini 3 Flash models. |
| **CORS** | ^2.8.5 | [github.com/expressjs/cors](https://github.com/expressjs/cors) | Managing cross-origin requests between Vercel and Render. |
| **Helmet** | ^7.1.0 | [helmetjs.github.io](https://helmetjs.github.io/) | Essential security headers for Express. |

---

## 4. AI INTEGRATION (GEMINI)
- **Model:** `gemini-3-flash-preview`
- **Primary Use Case:** Generation of `llm_generated_explanation.summary` and `llm_generated_explanation.clinical_caveats`.
- **Hallucination Prevention:** 
  - Risk labels (`Safe`, `Toxic`, etc.) are **deterministic**, generated by the `ruleEngine.ts` using fixed CPIC rules. 
  - The LLM is strictly used for *interpretation* of the deterministic results, not for *prediction*.
  - Prompt instructions require the model to use only the provided context (Gene, Phenotype, rsIDs).
- **Fallback Strategy:** If the Gemini API returns an error or times out, the system injects a pre-written clinical fallback from `geminiService.ts` to ensure the report remains functional.

---

## 5. VCF PROCESSING STACK
- **Engine:** Custom TypeScript-based parser (`vcfParser.ts`).
- **Dependencies:** None (Pure TypeScript).
- **Validation Logic:** 
  - Strict header check for `##fileformat=VCFv4.2`.
  - Validation of standard 9-column tab-delimited structure.
  - Multi-tag extraction logic: attempts to find gene symbols in `GENE=`, then `ANN=`, then `CSQ=` fields in the INFO column.
- **Output:** Transforms raw strings into a typed `VariantRecord[]`.

---

## 6. DEVOPS & INFRASTRUCTURE
- **Version Control:** Git + GitHub (public repository).
- **Frontend Hosting:** **Vercel** (Automatic deployment from `main` branch).
- **Backend Hosting:** **Render** (Web Service, auto-deploy from `main`).
- **Data Lifecycle:** Stateless. Genomic data exists only in memory for the duration of the request. No database is provisioned.
- **Environment Management:** Secured `.env` files with documentation provided in `.env.example`.

---

## 7. ENVIRONMENT VARIABLES
```bash
# Backend (.env)
GEMINI_API_KEY=AIzaSy... # Obtained from Google AI Studio
PORT=3000

# Frontend (.env)
VITE_API_URL=http://localhost:3000 # Local
# VITE_API_URL=https://pharmaguard-backend.onrender.com # Production
```

---

## 8. PACKAGE.JSON SCRIPTS

### Backend Scripts
- `npm run dev`: Starts the server with `tsx` watch mode.
- `npm run build`: Compiles TypeScript to `dist/`.
- `npm run start`: Executes the compiled `dist/server.js`.

### Frontend Scripts
- `npm run dev`: Launches Vite development server.
- `npm run build`: Generates production assets in `dist/`.
- `npm run type-check`: Validates TypeScript throughout the app.

---

## 9. DEPENDENCIES LOCK

### Frontend (`package.json`)
```json
{
  "dependencies": {
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "framer-motion": "^11.18.2",
    "lucide-react": "^0.475.0",
    "axios": "^1.7.9",
    "clsx": "^2.1.1",
    "tailwind-merge": "^2.3.0"
  },
  "devDependencies": {
    "typescript": "^5.5.3",
    "vite": "^6.0.0",
    "tailwindcss": "^3.4.0"
  }
}
```

### Backend (`package.json`)
```json
{
  "dependencies": {
    "express": "^4.19.2",
    "@google/genai": "^1.42.0",
    "multer": "^1.4.5-lts.1",
    "cors": "^2.8.5",
    "helmet": "^7.1.0",
    "dotenv": "^16.4.5"
  },
  "devDependencies": {
    "@types/node": "^20.14.0",
    "@types/express": "^4.17.21",
    "typescript": "^5.5.0",
    "tsx": "^4.19.0"
  }
}
```

---

## 10. SECURITY CONSIDERATIONS
- **Data Privacy:** Zero PII or genomic data persistence.
- **CORS Policy:** Restricted to allow only the Vercel frontend origin in production.
- **Input Sanitization:** Multer restricts file size to 5MB and validates `.vcf` extension.
- **API Protection:** The Gemini API key is stored strictly on the server; it is never transmitted to the client.
- **Rate Limiting:** Basic protection on the `/analyze` endpoint to prevent brute-force abuse.

---

## 11. KNOWN LIMITATIONS
- **Statelessness:** Users must re-upload VCF files if they refresh the page.
- **Simplification:** The rule engine covers primary CPIC guidelines but is not an exhaustive clinical database.
- **Rate Limits:** Gemini free tier may apply constraints during peak usage.
- **Mobile Experience:** Optimized for tablet/desktop; mobile is functional but primary for viewing results only.